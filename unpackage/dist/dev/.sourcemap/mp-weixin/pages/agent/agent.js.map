{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/54771/Desktop/PetDaily/pages/agent/agent.vue?4a6d","webpack:///C:/Users/54771/Desktop/PetDaily/pages/agent/agent.vue?76d2","webpack:///C:/Users/54771/Desktop/PetDaily/pages/agent/agent.vue?e959","webpack:///C:/Users/54771/Desktop/PetDaily/pages/agent/agent.vue?ed08","uni-app:///pages/agent/agent.vue","webpack:///C:/Users/54771/Desktop/PetDaily/pages/agent/agent.vue?d534"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","uniNavBar","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","data","messages","role","content","inputValue","scrollInto","methods","back","uni","url","sendMessage","showToast","text","title","icon","api","res","scrollToBottom"],"mappings":"4IAAA,MAGA,aACA,YAFAA,EAAGC,kCAAoCC,EAGvCC,EAAWC,a,gFCLX,oIACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,wBACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IACEA,EAAa,CACXC,UAAW,WACT,OAAO,2FAKX,MAAOC,GACP,IAC+C,IAA7CA,EAAEC,QAAQC,QAAQ,wBACa,IAA/BF,EAAEC,QAAQC,QAAQ,QAWlB,MAAMF,EATNG,QAAQC,MAAMJ,EAAEC,SAChBE,QAAQC,MAAM,mBACdD,QAAQC,MACN,uFAEFD,QAAQC,MACN,mDAMN,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G,iCCjCvB,yHAAmmB,eAAG,G,qJCkCtmB,Y,EAEA,CACAC,gBACA,OACAC,UACA,CAAAC,iBAAAC,+BAEAC,cACAC,gBAGAC,SACAC,gBACAC,aACAC,8BAGAC,uBAAA,0JACA,GADAC,qCACAC,sBACAA,GAAA,eAGA,OAFA,GACAJ,aAAAK,eAAAC,cACA,0BASA,OAJA,iBAAAZ,YAAAC,YACA,mBAGA,mCAKAY,iCAAA,QAAAC,SAEA,UAEA,iBACAd,iBACAC,kBAIA,iBACAD,iBACAC,yCAEA,qDAGAf,sCACA,iBACAc,iBACAC,uBACA,QAGA,OAHA,UAGA,+FA3CA,IA+CAc,0BAAA,WACA,2BACA,0BACA,oCAIA,c,6DC1GA,yHAA0pC,eAAG,G","file":"pages/agent/agent.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/agent/agent.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./agent.vue?vue&type=template&id=f92603dc&scoped=true&\"\nvar renderjs\nimport script from \"./agent.vue?vue&type=script&lang=js&\"\nexport * from \"./agent.vue?vue&type=script&lang=js&\"\nimport style0 from \"./agent.vue?vue&type=style&index=0&id=f92603dc&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f92603dc\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/agent/agent.vue\"\nexport default component.exports","export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./agent.vue?vue&type=template&id=f92603dc&scoped=true&\"","var components\ntry {\n  components = {\n    uniNavBar: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar\" */ \"@/uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./agent.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./agent.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"chat-container\">\n    <uni-nav-bar left-icon=\"left\" title=\"养宠小助手\" @clickLeft=\"back\" height=\"160rpx\" />\n    <!-- 聊天消息区域 -->\n    <scroll-view\n      class=\"message-list\"\n      scroll-y\n      :scroll-into-view=\"scrollInto\"\n      scroll-with-animation\n    >\n      <view\n        v-for=\"(msg, index) in messages\"\n        :key=\"index\"\n        :id=\"'msg-' + index\"\n        :class=\"['message-item', msg.role === 'user' ? 'user' : 'assistant']\"\n      >\n        <view class=\"bubble\">{{ msg.content }}</view>\n      </view>\n    </scroll-view>\n\n    <!-- 输入栏 -->\n    <view class=\"input-bar\">\n      <input\n        v-model=\"inputValue\"\n        class=\"input-box\"\n        placeholder=\"输入消息...\"\n        @confirm=\"sendMessage(false)\"\n      />\n      <button class=\"send-btn\" @click=\"sendMessage(true)\">发送</button>\n    </view>\n  </view>\n</template>\n\n<script>\nimport api from '../../utils/api.js'\n\nexport default {\n  data() {\n    return {\n      messages: [\n        { role: 'assistant', content: '您好，我是宠物助手，有什么可以帮您？' }\n      ],\n      inputValue: '',\n      scrollInto: ''\n    }\n  },\n  methods: {\n    back() {\n\t\t\t\tuni.switchTab({\n\t\t\t\t\turl: '/pages/master/master'\n\t\t\t\t});\n\t\t\t},\n    async sendMessage(showToast = true) {\n      const text = this.inputValue.trim()\n      if (!text) {\n        if (showToast) {\n          uni.showToast({ title: '消息不能为空', icon: 'none' })\n        }\n        return\n      }\n\n      // 1. 把用户输入推到界面上\n      this.messages.push({ role: 'user', content: text })\n      this.scrollToBottom()\n\n      // 2. 清空输入框\n      this.inputValue = ''\n\n      try {\n        // 3. 真正调用后端 askChatGPT\n        //    我们把整个对话 history 传给后端，让模型能上下文连贯\n        const res = await api.askChatGPT(this.messages)\n\n        if (res.success) {\n          // 4a. 成功：把 AI 的回复显示出来\n          this.messages.push({\n            role: 'assistant',\n            content: res.reply\n          })\n        } else {\n          // 4b. 后端返回了错误状态\n          this.messages.push({\n            role: 'assistant',\n            content: 'AI 服务异常：' + (res.message || '未知错误')\n          })\n        }\n      } catch (err) {\n        // 5. 网络或其它异常\n        console.error('askChatGPT 调用失败', err)\n        this.messages.push({\n          role: 'assistant',\n          content: '请求失败，请稍后重试'\n        })\n      } finally {\n        // 6. 滚动到底部\n        this.scrollToBottom()\n      }\n    },\n\n    scrollToBottom() {\n      this.$nextTick(() => {\n        const lastIndex = this.messages.length - 1\n        this.scrollInto = `msg-${lastIndex}`\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.chat-container {\n  height: 100vh;\n  display: flex;\n  flex-direction: column;\n  background: #f5f5f5;\n}\n\n.message-list {\n  flex: 1;\n  padding: 20rpx;\n  box-sizing: border-box;\n}\n\n.message-item {\n  display: flex;\n  margin: 30rpx 0;\n\n  &.user {\n    justify-content: flex-end; // 用户消息靠右\n  }\n\n  &.assistant {\n    justify-content: flex-start; // AI消息靠左\n  }\n}\n\n.bubble {\n  max-width: 75%;\n  padding: 20rpx;\n  border-radius: 12rpx;\n  line-height: 1.5;\n  word-break: break-word;\n  white-space: pre-wrap;\n  font-size: 28rpx;\n\n  // 用户气泡样式\n  .message-item.user & {\n    background: #95ec69;\n    border-top-right-radius: 4rpx; // 右侧尖角\n    margin-right: 20rpx;\n  }\n\n  // AI气泡样式\n  .message-item.assistant & {\n    background: #fff;\n    border-top-left-radius: 4rpx; // 左侧尖角\n    margin-left: 20rpx;\n  }\n}\n\n.input-bar {\n  display: flex;\n  padding: 20rpx;\n  background: #fff;\n  border-top: 1rpx solid #eee;\n\n  .input-box {\n    flex: 1;\n    margin-right: 20rpx;\n    padding: 12rpx 20rpx;\n    border: 1rpx solid #ddd;\n    border-radius: 8rpx;\n  }\n\n  .send-btn {\n    background: #07c160;\n    color: white;\n    padding: 0 30rpx;\n    border-radius: 8rpx;\n    font-size: 28rpx;\n  }\n}\n::v-deep .uni-navbar__header-container-inner {\n\talign-items: flex-end !important;\n\tmargin-bottom: 20rpx;\n}\n\n::v-deep .uni-navbar__header-btns-left {\n\talign-items: flex-end !important;\n\tmargin-bottom: 20rpx;\n}\n\n::v-deep .uni-navbar--border {\n\tborder-bottom-color: #f5f5f5 !important;\n}\n\n::v-deep .uni-navbar__header {\n\tbackground-color: #f5f5f5 !important;\n}\n</style>","import mod from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./agent.vue?vue&type=style&index=0&id=f92603dc&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./agent.vue?vue&type=style&index=0&id=f92603dc&lang=scss&scoped=true&\""],"sourceRoot":""}